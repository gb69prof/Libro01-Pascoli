<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Pascoli ‚Äì Lo stupore</title>

  <link rel="stylesheet" href="style.css" />
  <!-- Sistema temi globale -->
  <link rel="stylesheet" href="themes.css">
  <script src="themes.js" defer></script>

  <script defer src="script-common.js"></script>
</head>
<body data-section="stupore">

  <!-- NAVBAR LIBRO.0 -->
  <nav class="navbar-libro0">
    <div class="nav-logo">
      <a href="index.html">üìò Libro.0</a>
    </div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="lettura.html">Lettura</a></li>
      <li><a href="annota.html">Annota</a></li>
      <li><a href="mappe.html">Mappe</a></li>
      <li><a href="lavagna.html">Lavagna</a></li>
      <li><a href="timeline.html">Timeline</a></li>
      <li><a href="archivio.html">Archivio</a></li>
      <li><a href="crea.html">Crea</a></li>
      <li><a href="ricerca.html">Ricerca</a></li>
    </ul>
  </nav>

  <header class="top-bar">
    <div class="logo-area">
      <a href="index.html" class="logo-main">Libro.0</a>
      <span class="logo-sub">Giovanni Pascoli</span>
    </div>

    <div class="theme-switcher" aria-label="Selettore tema">
      <button data-theme="A">A</button>
      <button data-theme="B">B</button>
      <button data-theme="C">C</button>
      <button data-theme="D">D</button>
      <button data-theme="E">E</button>
    </div>

    <nav class="tools-nav" aria-label="Strumenti Libro.0">
      <button class="tool-btn" data-tool="mappe">üó∫Ô∏è Mappe</button>
      <button class="tool-btn" data-tool="lavagna">üìù Lavagna</button>
      <button class="tool-btn" data-tool="archivio">üìÅ Archivio</button>
    </nav>
  </header>

  <main class="reading-layout">
    <!-- Sidebar capitoli -->
    <aside class="sidebar">
      <h2>Capitoli</h2>
      <ol class="chapter-list">
        <li><a href="stupore.html" class="chapter-link" data-chapter="stupore">1 ¬∑ Lo stupore</a></li>
        <li><a href="visione.html" class="chapter-link" data-chapter="visione">2 ¬∑ Visione del mondo</a></li>
        <li><a href="fanciullino.html" class="chapter-link" data-chapter="fanciullino">3 ¬∑ Poetica del fanciullino</a></li>
        <li><a href="forma.html" class="chapter-link" data-chapter="forma">4 ¬∑ La forma</a></li>
        <li><a href="simbolismo.html" class="chapter-link" data-chapter="simbolismo">5 ¬∑ Il simbolismo</a></li>
      </ol>
    </aside>

    <!-- Pagina di libro centrale -->
    <section class="reading-container">
      <div class="book-page-wrapper">
        <header class="section-header">
          <h1>Lo stupore</h1>
          <p class="section-subtitle">
            Testo fisso + schema visivo, come in una doppia pagina di libro.
          </p>
        </header>

        <div class="book-page-grid">
          <!-- Pagina sinistra: testo -->
          <article class="book-text-column">
            <section class="lesson-text">
              <p><strong>LO STUPORE</strong></p>

              <p>
                Per Pascoli la poesia nasce dalla meraviglia: il poeta √® un ‚Äúfanciullino‚Äù che sogna alla luce e
                vede nel buio, scoprendo ogni cosa come fosse nuova. Questa idea deriva sia dalla tradizione
                poetica (Leopardi), sia dai lutti che segnarono la sua vita. Il dolore lo porta a rifiutare la
                fiducia nella scienza positivista e ad abbracciare una visione irrazionale, vicina al
                Decadentismo.
              </p>

              <p>
                Il nido-famiglia diventa rifugio e simbolo di protezione; la politica si intreccia con i
                sentimenti (socialismo come fratellanza, nazionalismo come casa per gli emigranti). Lo stile
                riflette questa visione: sintassi frammentata, figure foniche (allitterazioni, onomatopee) e
                sinestesie. La realt√† non √® gi√† data, ma nasce ogni volta nello sguardo del poeta.
              </p>

              <h2>Schema sintetico</h2>
              <ul>
                <li>Poesia = stupore e scoperta del mondo.</li>
                <li>Influenze: tradizione (Leopardi) + biografia segnata dai lutti.</li>
                <li>Rifiuto della scienza ‚Üí dolore cosmico.</li>
                <li>Nido-famiglia = rifugio, simbolo costante.</li>
                <li>Politica: socialismo (fratellanza), nazionalismo (nido per emigranti).</li>
                <li>Stile: sintassi semplice, paratassi, figure foniche, sinestesie.</li>
                <li>Realt√† = simbolo che nasce dallo sguardo del poeta.</li>
              </ul>

              <h2>Saperi irrinunciabili</h2>
              <ul>
                <li>Il poeta √® un fanciullino che si stupisce di tutto.</li>
                <li>Il dolore familiare segna la sua visione del mondo.</li>
                <li>Rifiuta la scienza positivista.</li>
                <li>Centrale il simbolo del nido-famiglia.</li>
                <li>Sintassi paratattica e figure sonore.</li>
              </ul>

              <h2>Vocabolario</h2>
              <ul>
                <li><strong>Fanciullino</strong>: parte infantile che resta viva nell‚Äôuomo e nel poeta.</li>
                <li><strong>Nido-famiglia</strong>: simbolo di protezione e rifugio dagli affanni.</li>
                <li><strong>Paratassi</strong>: costruzione di frasi coordinate senza subordinazione.</li>
                <li><strong>Sinestesia</strong>: accostamento di sensazioni di sfere sensoriali diverse.</li>
                <li><strong>Allitterazione</strong>: ripetizione di suoni uguali o simili in una frase.</li>
              </ul>
            </section>

            <nav class="section-nav">
              <a class="nav-prev" href="index.html">‚¨Ö Torna all'indice</a>
              <a class="nav-next" href="visione.html">Sezione successiva: Visione del mondo ‚û°</a>
            </nav>
          </article>

          <!-- Pagina destra: schema -->
          <aside class="book-schema-column">
            <figure class="schema-card">
              <figcaption>
                <img
                  class="img-wrap enlargeable"
                  src="assets/Stupore.png"
                  alt="Schema sullo stupore pascoliano"
                />
                Schema-guida per lo stupore pascoliano: il fanciullino che guarda il mondo come se fosse
                sempre nuovo, il nido-famiglia come rifugio, il dolore che incrina la fiducia nella scienza
                positivista e apre a una visione decadente della realt√†.
              </figcaption>
            </figure>
          </aside>
        </div>
      </div>
    </section>

    <!-- Margine attivo -->
    <aside class="margin-column">
      <h2>Margine attivo</h2>
      <p class="current-section-label">
        Sezione attuale: <span id="current-section-name"></span>
      </p>

      <div class="margin-block">
        <h3>Evidenzia</h3>
        <p>Seleziona una frase nel testo, poi clicca:</p>
        <button id="btn-highlight" class="margin-btn">Evidenzia selezione</button>
        <button id="btn-clear-highlights" class="margin-btn margin-btn-secondary">
          Pulisci evidenziazioni
        </button>
      </div>

      <div class="margin-block">
        <h3>Nota rapida</h3>
        <textarea id="note-input" rows="4" placeholder="Scrivi una nota personale..."></textarea>
        <button id="btn-save-note" class="margin-btn">Salva nota</button>
        <ul id="note-list" class="note-list"></ul>
      </div>

      <div class="margin-block">
        <h3>Invia a...</h3>
        <p>Trasforma ci√≤ che hai capito in azione:</p>
        <div class="margin-actions">
          <button class="margin-chip" data-destination="mappa">Mappa concettuale</button>
          <button class="margin-chip" data-destination="timeline">Timeline</button>
          <button class="margin-chip" data-destination="lavagna">Lavagna</button>
          <button class="margin-chip" data-destination="archivio">Archivio personale</button>
        </div>
        <p class="small">
          Questi pulsanti registrano la tua intenzione e possono essere collegati a strumenti reali
          nelle versioni successive del Libro.0.
        </p>
      </div>
    </aside>
  </main>

  <!-- Modale strumenti -->
  <div id="modal-overlay" class="modal-overlay" hidden>
    <div class="modal">
      <button class="modal-close" id="modal-close">‚úï</button>
      <div id="modal-content"></div>
    </div>
  </div>

  <!-- Script evidenziazione + salvataggio locale (versione robusta per iPad) -->
  <script>
    (function () {
      const HIGHLIGHT_STORAGE_KEY = "libro0_stupore_lesson_html";

      const lessonEl = document.querySelector(".lesson-text");
      const btnHighlight = document.getElementById("btn-highlight");
      const btnClear = document.getElementById("btn-clear-highlights");

      if (!lessonEl || !btnHighlight || !btnClear) return;

      // 1. Ripristina le evidenziazioni salvate
      const savedHtml = localStorage.getItem(HIGHLIGHT_STORAGE_KEY);
      if (savedHtml) {
        lessonEl.innerHTML = savedHtml;
      }

      function saveHighlights() {
        localStorage.setItem(HIGHLIGHT_STORAGE_KEY, lessonEl.innerHTML);
      }

      // 2. Evidenzia selezione
      btnHighlight.addEventListener("click", () => {
        const selection = window.getSelection();
        if (!selection || !selection.rangeCount) return;

        const range = selection.getRangeAt(0);

        // La selezione deve essere dentro il testo della lezione
        if (!lessonEl.contains(range.commonAncestorContainer)) return;
        if (range.collapsed) return; // niente testo selezionato

        const mark = document.createElement("mark");
        mark.classList.add("highlighted-text");

        try {
          // Metodo pi√π robusto: estrai il contenuto selezionato e reinseriscilo dentro <mark>
          const contents = range.extractContents();
          mark.appendChild(contents);
          range.insertNode(mark);

          selection.removeAllRanges();
          saveHighlights();
        } catch (e) {
          console.warn("Impossibile evidenziare questa selezione:", e);
        }
      });

      // 3. Pulisci tutte le evidenziazioni
      btnClear.addEventListener("click", () => {
        const marks = lessonEl.querySelectorAll("mark.highlighted-text, mark");
        marks.forEach((m) => {
          const parent = m.parentNode;
          while (m.firstChild) {
            parent.insertBefore(m.firstChild, m);
          }
          parent.removeChild(m);
        });
        saveHighlights();
      });
    })();
  </script>
</body>
</html>

