<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Libro.0 ‚Äì Stanza della lavagna</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="themes.css" />
  <script src="themes.js" defer></script>
  <script src="script-common.js" defer></script>

  <style>
    /* Toolbar e canvas specifici della lavagna */
    .lavagna-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .lavagna-toolbar label {
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .lavagna-toolbar input[type="range"] {
      width: 140px;
    }

    .lavagna-colors {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.9rem;
    }

    .lavagna-color-dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid rgba(0,0,0,0.35);
      cursor: pointer;
      padding: 0;
      background-clip: padding-box;
    }

    .lavagna-color-dot.active {
      box-shadow: 0 0 0 2px rgba(47,107,255,0.7);
    }

    .theme-D .lavagna-color-dot {
      border-color: rgba(255,255,255,0.7);
    }

    .lavagna-tools-mode {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .lavagna-tool {
      font-size: 0.85rem;
      padding: 0.3rem 0.75rem;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.2);
      background: rgba(255,255,255,0.9);
      cursor: pointer;
      transition: background 0.15s, box-shadow 0.15s, transform 0.1s;
    }

    .lavagna-tool.active {
      background: #2f6bff;
      color: #ffffff;
      border-color: transparent;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }

    .theme-D .lavagna-tool {
      background: rgba(15,15,15,0.9);
      color: #f5f5f5;
      border-color: rgba(255,255,255,0.35);
    }

    .theme-D .lavagna-tool.active {
      background: #4b82ff;
      border-color: transparent;
      color: #ffffff;
    }

    #lavagna-canvas {
      width: 100%;
      max-width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.15);
      background: #ffffff;
      display: block;
      margin: 0 auto;
      touch-action: none; /* evita scroll/zoom con il dito */
    }

    .theme-D #lavagna-canvas {
      background: #111111;
      border-color: rgba(255,255,255,0.2);
    }
  </style>
</head>
<body data-page="lavagna">
  <!-- NAVBAR LIBRO.0 -->
  <nav class="navbar-libro0">
    <div class="nav-logo">
      <a href="index.html">üìò Libro.0</a>
    </div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="lettura.html">Lettura</a></li>
      <li><a href="annota.html">Annota</a></li>
      <li><a href="mappe.html">Mappe</a></li>
      <li><a href="lavagna.html">Lavagna</a></li>
      <li><a href="timeline.html">Timeline</a></li>
      <li><a href="archivio.html">Archivio</a></li>
      <li><a href="crea.html">Crea</a></li>
      <li><a href="ricerca.html">Ricerca</a></li>
    </ul>
  </nav>

  <header class="top-bar">
    <div class="logo-area">
      <span class="logo-main">Libro.0</span>
      <span class="logo-sub">Stanza della lavagna</span>
    </div>
    <div class="theme-switcher" aria-label="Selettore tema">
      <button data-theme="A">A</button>
      <button data-theme="B">B</button>
      <button data-theme="C">C</button>
      <button data-theme="D">D</button>
      <button data-theme="E">E</button>
    </div>
  </header>

  <main class="room-main">
    <section class="room-intro">
      <h1>Lavagna digitale</h1>
      <p>
        Qui puoi disegnare schemi liberi, frecce, sottolineature: √® lo spazio pi√π vicino
        alla lavagna d'aula. Il tratto segue il dito, puoi cambiare colore e usare la gomma
        per correggere solo ci√≤ che ti serve.
      </p>
    </section>

    <section class="room-grid">
      <div class="room-card full-width">
        <h2>Area di disegno</h2>
        <p>Usa il mouse o il dito (su tablet) per scrivere sulla lavagna.</p>

        <div class="lavagna-toolbar">
          <div class="lavagna-colors">
            <span>Colore penna:</span>
            <button type="button"
                    class="lavagna-color-dot active"
                    data-pen-color="#000000"
                    style="background:#000000;"></button>
            <button type="button"
                    class="lavagna-color-dot"
                    data-pen-color="#d62828"
                    style="background:#d62828;"></button>
            <button type="button"
                    class="lavagna-color-dot"
                    data-pen-color="#1d4ed8"
                    style="background:#1d4ed8;"></button>
            <button type="button"
                    class="lavagna-color-dot"
                    data-pen-color="#16a34a"
                    style="background:#16a34a;"></button>
          </div>

          <label>
            Spessore
            <input type="range" id="pen-size" min="1" max="18" value="4">
          </label>

          <div class="lavagna-tools-mode">
            <button id="lavagna-pen" class="lavagna-tool active" type="button">‚úèÔ∏è Penna</button>
            <button id="lavagna-eraser" class="lavagna-tool" type="button">ü©π Gomma</button>
          </div>

          <button id="lavagna-clear" class="secondary-btn" type="button">üßΩ Pulisci</button>
        </div>

        <canvas id="lavagna-canvas" class="lavagna-canvas" width="900" height="500"></canvas>
      </div>
    </section>
  </main>

  <script>
    (function() {
      const canvas = document.getElementById("lavagna-canvas");
      const ctx = canvas.getContext("2d");
      const sizeInput = document.getElementById("pen-size");
      const clearBtn = document.getElementById("lavagna-clear");
      const colorButtons = document.querySelectorAll(".lavagna-color-dot");
      const penBtn = document.getElementById("lavagna-pen");
      const eraserBtn = document.getElementById("lavagna-eraser");

      let drawing = false;
      let lastX = 0, lastY = 0;
      let currentColor = "#000000";
      let mode = "pen"; // "pen" | "eraser"

      // Gestione selezione colore penna
      function setActiveColorButton(btn) {
        colorButtons.forEach(b => b.classList.remove("active"));
        if (btn) btn.classList.add("active");
      }

      colorButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const color = btn.getAttribute("data-pen-color") || "#000000";
          currentColor = color;
          setActiveColorButton(btn);
          // se sto cambiando colore, la modalit√† resta penna (non forzo, ma avrebbe senso)
        });
      });

      // Default: primo bottone (nero)
      setActiveColorButton(colorButtons[0]);

      // Toggle Penna / Gomma
      function setMode(newMode) {
        mode = newMode;
        if (mode === "pen") {
          penBtn.classList.add("active");
          eraserBtn.classList.remove("active");
        } else {
          eraserBtn.classList.add("active");
          penBtn.classList.remove("active");
        }
      }

      penBtn.addEventListener("click", () => setMode("pen"));
      eraserBtn.addEventListener("click", () => setMode("eraser"));

      // Calcolo posizione con correzione di scala (fondamentale per il dito)
      function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches ? e.touches[0] : e;

        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;

        return {
          x: (touch.clientX - rect.left) * scaleX,
          y: (touch.clientY - rect.top) * scaleY
        };
      }

      function start(e) {
        e.preventDefault();
        drawing = true;
        const pos = getPos(e);
        lastX = pos.x;
        lastY = pos.y;
      }

      function move(e) {
        if (!drawing) return;
        e.preventDefault();
        const pos = getPos(e);

        ctx.lineWidth = Number(sizeInput.value || 4);
        ctx.lineCap = "round";
        ctx.lineJoin = "round";

        ctx.save();

        if (mode === "eraser") {
          // Cancella solo dove passa: destination-out
          ctx.globalCompositeOperation = "destination-out";
          ctx.strokeStyle = "rgba(0,0,0,1)";
        } else {
          ctx.globalCompositeOperation = "source-over";
          ctx.strokeStyle = currentColor;
        }

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();

        ctx.restore();

        lastX = pos.x;
        lastY = pos.y;
      }

      function end() {
        drawing = false;
      }

      canvas.addEventListener("mousedown", start);
      canvas.addEventListener("mousemove", move);
      document.addEventListener("mouseup", end);

      canvas.addEventListener("touchstart", start, { passive: false });
      canvas.addEventListener("touchmove", move, { passive: false });
      canvas.addEventListener("touchend", end);

      clearBtn.addEventListener("click", () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.globalCompositeOperation = "source-over";
      });
    })();
  </script>
</body>
</html>

